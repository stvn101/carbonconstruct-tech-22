import{g as T,r as m,j as e,b as w,c as y,d as E,e as C,U as R,a4 as n,G as o,ac as h,aa as S,B as f,s as p}from"./index-CHtXOOwB.js";import{S as N}from"./shield-C3KNxYec.js";const J=()=>{const{user:s,profile:d,session:t}=T(),[a,g]=m.useState({isAuthenticated:!1,userId:null,userEmail:null,profileRole:null,isInAdminsTable:!1,hasJWTAdminRole:!1,adminTableEmails:[]}),[x,u]=m.useState(!1),r=async()=>{var l;u(!0);try{const{data:i}=await p.from("admins").select("email"),j=(i==null?void 0:i.map(v=>v.email).filter(Boolean))||[],c=t!=null&&t.access_token?JSON.parse(atob(t.access_token.split(".")[1])):null,A=((l=c==null?void 0:c.app_metadata)==null?void 0:l.role)==="admin";g({isAuthenticated:!!s,userId:(s==null?void 0:s.id)||null,userEmail:(s==null?void 0:s.email)||null,profileRole:(d==null?void 0:d.role)||null,isInAdminsTable:j.includes((s==null?void 0:s.email)||""),hasJWTAdminRole:A,adminTableEmails:j})}catch(i){console.error("Error checking admin status:",i)}finally{u(!1)}},b=async()=>{if(s!=null&&s.email)try{const{error:l}=await p.from("admins").insert([{email:s.email,id:s.id}]);if(l)throw l;r(),alert("Added to admins table successfully!")}catch(l){console.error("Error adding to admins:",l),alert("Error adding to admins table. Check console for details.")}};return m.useEffect(()=>{s&&r()},[s,t]),e.jsxs(w,{className:"max-w-2xl mx-auto",children:[e.jsx(y,{children:e.jsxs(E,{className:"flex items-center gap-2",children:[e.jsx(N,{className:"h-5 w-5"}),"Admin Status Checker"]})}),e.jsxs(C,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(R,{className:"h-4 w-4"}),e.jsx("span",{children:"Authentication Status"})]}),a.isAuthenticated?e.jsxs(n,{variant:"default",className:"bg-green-500",children:[e.jsx(o,{className:"h-3 w-3 mr-1"}),"Authenticated"]}):e.jsxs(n,{variant:"destructive",children:[e.jsx(h,{className:"h-3 w-3 mr-1"}),"Not Authenticated"]})]}),a.isAuthenticated&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-2 p-3 bg-muted rounded-lg",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"User ID:"})," ",a.userId]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Email:"})," ",a.userEmail]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Profile Role:"})," ",a.profileRole||"None"]})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(S,{className:"h-4 w-4"}),e.jsx("span",{children:"In Admins Table"})]}),a.isInAdminsTable?e.jsxs(n,{variant:"default",className:"bg-green-500",children:[e.jsx(o,{className:"h-3 w-3 mr-1"}),"Yes"]}):e.jsxs(n,{variant:"destructive",children:[e.jsx(h,{className:"h-3 w-3 mr-1"}),"No"]})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(N,{className:"h-4 w-4"}),e.jsx("span",{children:"JWT Admin Role"})]}),a.hasJWTAdminRole?e.jsxs(n,{variant:"default",className:"bg-green-500",children:[e.jsx(o,{className:"h-3 w-3 mr-1"}),"Has Admin Role"]}):e.jsxs(n,{variant:"destructive",children:[e.jsx(h,{className:"h-3 w-3 mr-1"}),"No Admin Role"]})]}),e.jsxs("div",{className:"p-3 bg-muted rounded-lg",children:[e.jsx("p",{className:"font-medium mb-2",children:"Emails in Admins Table:"}),a.adminTableEmails.length>0?e.jsx("ul",{className:"list-disc list-inside text-sm",children:a.adminTableEmails.map((l,i)=>e.jsx("li",{children:l},i))}):e.jsx("p",{className:"text-muted-foreground text-sm",children:"No admin emails found"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(f,{onClick:r,disabled:x,children:x?"Checking...":"Refresh Status"}),!a.isInAdminsTable&&e.jsx(f,{onClick:b,variant:"outline",children:"Add Myself to Admins Table"})]}),e.jsxs("div",{className:"p-4 border-2 rounded-lg",children:[e.jsx("p",{className:"font-medium mb-2",children:"Admin Access Summary:"}),a.isInAdminsTable||a.hasJWTAdminRole?e.jsx("p",{className:"text-green-600",children:"✅ You have admin access!"}):e.jsx("p",{className:"text-red-600",children:"❌ You do not have admin access. Add yourself to the admins table above."})]})]}),!a.isAuthenticated&&e.jsx("div",{className:"text-center p-4 bg-yellow-50 rounded-lg",children:e.jsx("p",{className:"text-yellow-800",children:"Please sign in first to check your admin status."})})]})]})};export{J as AdminStatusChecker};
//# sourceMappingURL=AdminStatusChecker-Bi7rB3gV.js.map
