import{j as e,b as p,c as q,d as P,D as R,a4 as S,e as w,B as h,C as k,av as D,aw as v,g as T,r as d,ax as u,s as l,i as o,m as B,H,N as L,F as M}from"./index-CHtXOOwB.js";const Y=({notification:t,onMarkAsRead:n,onDelete:c,formatDate:f,getNotificationColor:m})=>e.jsxs(p,{className:t.read?"opacity-75":"border-l-4 border-l-carbon-600",children:[e.jsx(q,{className:"pb-2",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx(P,{className:"text-lg",children:t.title}),e.jsx(R,{className:"text-xs",children:f(t.created_at)})]}),e.jsx(S,{className:m(t.type),children:t.type})]})}),e.jsxs(w,{children:[e.jsx("p",{className:"text-sm",children:t.message}),e.jsxs("div",{className:"flex justify-end mt-4 gap-2",children:[!t.read&&e.jsxs(h,{variant:"outline",size:"sm",onClick:()=>n(t.id),children:[e.jsx(k,{className:"h-4 w-4 mr-1"}),"Mark as read"]}),e.jsxs(h,{variant:"outline",size:"sm",onClick:()=>c(t.id),children:[e.jsx(D,{className:"h-4 w-4 mr-1"}),"Delete"]})]})]})]}),z=()=>e.jsx(p,{className:"text-center py-12",children:e.jsxs(w,{children:[e.jsx(v,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium mb-2",children:"No notifications yet"}),e.jsx("p",{className:"text-muted-foreground",children:"You don't have any notifications at the moment."})]})}),I=({hasUnreadNotifications:t,onMarkAllAsRead:n})=>e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(v,{className:"h-6 w-6 text-carbon-600"}),e.jsx("h1",{className:"text-2xl md:text-3xl font-bold",children:"Notifications"})]}),t&&e.jsxs(h,{variant:"outline",onClick:n,children:[e.jsx(k,{className:"h-4 w-4 mr-2"}),"Mark all as read"]})]}),U=t=>new Date(t).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),$=t=>{switch(t){case"info":return"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-300";case"success":return"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-300";case"warning":return"bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-300";case"error":return"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-300";default:return"bg-gray-100 text-gray-800 dark:bg-gray-800 dark:text-gray-300"}},V=()=>{const{user:t}=T(),[n,c]=d.useState([]),[f,m]=d.useState(!0),[g,b]=d.useState(null),[y,j]=d.useState(0),x=d.useCallback(async()=>{if(t){m(!0),b(null);try{if(u())throw new Error("You're offline. Please check your internet connection.");const r=new Promise((N,_)=>{setTimeout(()=>_(new Error("Request timed out")),1e4)}),a=l.from("notifications").select("id, title, message, type, read, created_at").eq("user_id",t.id).order("created_at",{ascending:!1}),{data:s,error:i}=await Promise.race([a,r]);if(i)throw i;c(s),j(0)}catch(r){console.error("Error fetching notifications:",r),b(r instanceof Error?r:new Error("Failed to load notifications")),y>1&&o.error("Failed to load notifications. Please try again later."),u()&&o.error("You're offline. Please check your connection."),j(a=>a+1)}finally{m(!1)}}},[t,y]);d.useEffect(()=>{if(x(),t&&!u()){const r=l.channel("notifications-page").on("postgres_changes",{event:"INSERT",schema:"public",table:"notifications",filter:`user_id=eq.${t.id}`},a=>{const s=a.new;s&&(c(N=>[s,...N]),String(s.type||"").toLowerCase().includes("payment")||o.info(`New notification: ${s.title}`))}).subscribe();return()=>{l.removeChannel(r)}}},[t,x]);const C=async r=>{try{const{error:a}=await l.from("notifications").update({read:!0}).eq("user_id",t==null?void 0:t.id).eq("id",r);if(a)throw a;c(s=>s.map(i=>i.id===r?{...i,read:!0}:i))}catch(a){console.error("Error marking notification as read:",a),o.error("Failed to update notification")}},E=async r=>{try{const{error:a}=await l.from("notifications").delete().eq("user_id",t==null?void 0:t.id).eq("id",r);if(a)throw a;c(s=>s.filter(i=>i.id!==r)),o.success("Notification deleted")}catch(a){console.error("Error deleting notification:",a),o.error("Failed to delete notification")}},A=async()=>{try{const{error:r}=await l.from("notifications").update({read:!0}).eq("user_id",t==null?void 0:t.id).eq("read",!1);if(r)throw r;c(a=>a.map(s=>({...s,read:!0}))),o.success("All notifications marked as read")}catch(r){console.error("Error marking all notifications as read:",r),o.error("Failed to update notifications")}},F=d.useCallback(()=>{x()},[x]);return e.jsxs(B.div,{className:"min-h-screen flex flex-col bg-carbon-50 dark:bg-carbon-900",initial:{opacity:0},animate:{opacity:1},transition:{duration:.4},children:[e.jsxs(H,{children:[e.jsx("title",{children:"Notifications | CarbonConstruct"}),e.jsx("meta",{name:"description",content:"View and manage your notifications."})]}),e.jsx(L,{}),e.jsx("main",{className:"flex-grow py-12 px-4 pt-24",children:e.jsxs("div",{className:"container mx-auto max-w-3xl",children:[e.jsx(I,{hasUnreadNotifications:n.some(r=>!r.read),onMarkAllAsRead:A}),f?e.jsx("div",{className:"flex justify-center my-12",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-carbon-600"})}):g?e.jsxs("div",{className:"my-8 p-6 bg-red-50 dark:bg-red-900/20 rounded-lg border border-red-200 dark:border-red-800 text-center",children:[e.jsx("h3",{className:"text-lg font-semibold text-red-700 dark:text-red-300 mb-2",children:g.message||"Failed to load notifications"}),e.jsx("p",{className:"text-red-600 dark:text-red-400 mb-4",children:"Please check your connection and try again."}),e.jsx("button",{onClick:F,className:"px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700 transition-colors",children:"Try Again"})]}):n.length>0?e.jsx("div",{className:"space-y-4",children:n.map(r=>e.jsx(Y,{notification:r,onMarkAsRead:C,onDelete:E,formatDate:U,getNotificationColor:$},r.id))}):e.jsx(z,{})]})}),e.jsx(M,{})]})};export{V as default};
//# sourceMappingURL=Notifications-DCcD-zu7.js.map
