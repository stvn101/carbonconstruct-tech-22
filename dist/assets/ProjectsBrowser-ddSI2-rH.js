import{r as s,j as e,b as E,c as S,d as D,S as O,I,e as T,p as v,E as B,O as F,a4 as L,b9 as b,ab as M,aM as Y,ac as _,aQ as z,ad as H,B as N,a1 as A,i as g,ba as U,as as $,g as W,m as J,H as Q,N as q,bb as G,J as K,t as V,z as X,F as Z}from"./index-CHtXOOwB.js";import{C as ee}from"./calendar-Ce1fAqbV.js";import{S as se}from"./scroll-area-CvAawM1u.js";import{F as k}from"./folder-plus-ChE6HL0h.js";const te=({projects:t,title:n="Your Projects",showSearch:l=!0})=>{const[a,f]=s.useState(""),m=s.useMemo(()=>{if(a==="")return t;const r=a.toLowerCase();return t.filter(c=>c.name.toLowerCase().includes(r)||(c.description||"").toLowerCase().includes(r))},[t,a]),p=s.useMemo(()=>[...m].sort((r,c)=>new Date(c.updated_at).getTime()-new Date(r.updated_at).getTime()),[m]);return e.jsxs(E,{children:[e.jsxs(S,{children:[e.jsx(D,{children:n}),l&&e.jsxs("div",{className:"relative mt-2",children:[e.jsx(O,{className:"absolute left-2 top-2.5 h-4 w-4 text-muted-foreground"}),e.jsx(I,{placeholder:"Search projects...",className:"pl-8",value:a,onChange:r=>f(r.target.value)})]})]}),e.jsx(T,{children:p.length>0?e.jsx("div",{className:"space-y-2",children:p.map(r=>e.jsx(v,{to:`/projects/${r.id}`,className:"block",children:e.jsx("div",{className:"p-3 border rounded-lg hover:bg-carbon-50 dark:hover:bg-carbon-800 transition-colors",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"bg-carbon-100 dark:bg-carbon-800 p-1.5 rounded-md mr-3",children:e.jsx(B,{className:"h-4 w-4 text-carbon-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium",children:r.name}),e.jsxs("div",{className:"flex items-center text-xs text-muted-foreground mt-1",children:[e.jsx(ee,{className:"h-3 w-3 mr-1"}),e.jsx("span",{children:new Date(r.updated_at).toLocaleDateString()}),r.result&&e.jsxs("span",{className:"ml-2 flex items-center",children:[e.jsx(F,{className:"h-3 w-3 mx-1"}),Math.round(r.result.totalEmissions)," kg COâ‚‚e"]})]})]})]}),r.tags&&r.tags.length>0&&e.jsxs("div",{className:"hidden md:flex space-x-1",children:[r.tags.slice(0,2).map(c=>e.jsx(L,{variant:"outline",className:"text-xs",children:c},c)),r.tags.length>2&&e.jsxs(L,{variant:"outline",className:"text-xs",children:["+",r.tags.length-2]})]})]})})},r.id))}):e.jsx("div",{className:"text-center py-8",children:e.jsx("p",{className:"text-muted-foreground",children:"No projects found"})})})]})};function re(){return e.jsxs(E,{children:[e.jsxs(S,{className:"space-y-2",children:[e.jsx(b,{className:"h-5 w-1/2"}),e.jsx(b,{className:"h-4 w-1/3"})]}),e.jsxs(T,{className:"space-y-4",children:[e.jsx(b,{className:"h-20 w-full"}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx(b,{className:"h-4 w-24"}),e.jsx(b,{className:"h-4 w-24"})]})]})]})}const ne=({isOffline:t,hasError:n,onRetry:l,isRetrying:a})=>!t&&!n?null:e.jsxs(M,{variant:t?"warning":"destructive",className:"mb-6",children:[t?e.jsx(Y,{className:"h-5 w-5"}):e.jsx(_,{className:"h-5 w-5"}),e.jsx(z,{children:t?"Connection Issue Detected":"Error Loading Projects"}),e.jsxs(H,{children:[t?"You're currently offline or we can't reach our servers. Your projects will appear when the connection is restored.":"We're experiencing technical issues loading your projects. Our team has been notified.",e.jsx("div",{className:"mt-2",children:e.jsxs(N,{onClick:l,variant:"outline",size:"sm",disabled:a,children:[e.jsx(A,{className:`h-4 w-4 mr-2 ${a?"animate-spin":""}`}),a?"Checking...":"Try Again"]})})]})]});function ae(t=!0){const{isOnline:n}=C(),[l,a]=s.useState(!0),[f,m]=s.useState(!1),[p,r]=s.useState(null),[c,y]=s.useState(0),d=s.useRef(!0),o=s.useRef({failure:!1,success:!1,timestamp:0});function C(){const[i,u]=s.useState(typeof navigator<"u"?navigator.onLine:!0);return s.useEffect(()=>{if(typeof window>"u")return;const h=()=>u(!0),j=()=>u(!1);return window.addEventListener("online",h),window.addEventListener("offline",j),()=>{window.removeEventListener("online",h),window.removeEventListener("offline",j)}},[]),{isOnline:i}}s.useEffect(()=>()=>{d.current=!1,g.dismiss("connection-check-failed"),g.dismiss("connection-restored")},[]);const x=s.useCallback(async()=>{if(!n||!t||!d.current||f)return l;m(!0),y(u=>u+1);let i=!1;try{if(i=await U(),d.current){if(i!==l){a(i);const u=Date.now();!i&&!o.current.failure?(g.error("Unable to connect to the server. Using offline mode.",{id:"connection-check-failed",duration:5e3}),o.current.failure=!0,o.current.timestamp=u):i&&!o.current.success&&o.current.failure&&(g.success("Connection restored successfully!",{id:"connection-restored",duration:3e3}),o.current.success=!0,o.current.failure=!1,setTimeout(()=>{d.current&&(o.current.success=!1,o.current.failure=!1)},6e4))}r(new Date),m(!1)}return i}catch{return d.current&&(a(!1),m(!1),r(new Date)),!1}},[n,t,l,f]);return s.useEffect(()=>{if(!d.current)return;const i=setTimeout(()=>{d.current&&x()},3e3),u=setInterval(()=>{d.current&&n&&t&&x()},12e4);return()=>{clearTimeout(i),clearInterval(u)}},[n,t,x]),s.useEffect(()=>{if(d.current&&n&&t&&!l){const i=setTimeout(()=>{d.current&&x()},2e3);return()=>clearTimeout(i)}},[n,t,x,l]),{isOfflineMode:!n||!l,isCheckingConnection:f,lastConnectionCheck:p,connectionAttempts:c,checkConnection:x}}const de=()=>{const{projects:t,isLoading:n,fetchError:l,loadProjects:a}=$(),{user:f,profile:m}=W(),p=f&&(m==null?void 0:m.subscription_tier)==="premium",[r,c]=s.useState(!1),[y,d]=s.useState(0),{isOfflineMode:o,checkConnection:C,connectionAttempts:x,isCheckingConnection:i}=ae(),u=s.useRef(!1),h=s.useRef(null),j=s.useRef(null);s.useEffect(()=>(n&&(j.current=setTimeout(()=>{n&&(g.error("Loading projects timed out. Please try refreshing."),c(!0))},15e3)),()=>{j.current&&clearTimeout(j.current)}),[n]),s.useEffect(()=>{if(!u.current){u.current=!0;const w=setTimeout(()=>{c(!0)},300);return()=>clearTimeout(w)}},[]);const P=s.useCallback(()=>{h.current||(d(w=>w+1),g.loading("Checking connection...",{id:"retry-connection-check"}),C(),h.current=setTimeout(()=>{g.dismiss("retry-connection-check"),a&&a().catch(w=>{console.error("Error reloading projects:",w),g.error("Failed to load projects. Please try again later.")}),c(!1),setTimeout(()=>{c(!0),h.current=null},300)},1500))},[C,a]);return s.useEffect(()=>()=>{h.current&&clearTimeout(h.current),j.current&&clearTimeout(j.current)},[]),e.jsxs(J.div,{className:`min-h-screen flex flex-col bg-carbon-50 dark:bg-carbon-900 overflow-x-hidden ${p?"premium-user":""}`,initial:{opacity:0},animate:{opacity:1},transition:{duration:.4},children:[e.jsxs(Q,{children:[e.jsx("title",{children:"Browse Projects | CarbonConstruct"}),e.jsx("meta",{name:"description",content:"Browse and manage your carbon calculation projects"})]}),e.jsx(q,{}),e.jsx("main",{className:"flex-grow content-top-spacing px-4 pb-12 overflow-y-auto",children:r?e.jsx(K,{feature:"Projects Browser",ignoreErrors:!0,resetCondition:y,children:e.jsx(se,{className:"h-full w-full",children:e.jsxs("div",{className:"container mx-auto",children:[e.jsx("div",{className:"mb-6 pt-16",children:e.jsx(N,{variant:"ghost",asChild:!0,className:"mb-4",children:e.jsxs(v,{to:"/dashboard",children:[e.jsx(V,{className:"h-4 w-4 mr-2"}),"Back to Dashboard"]})})}),e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl md:text-3xl font-bold",children:"Projects Browser"}),e.jsx("p",{className:"text-muted-foreground",children:"Find and manage all your carbon calculation projects"})]}),e.jsxs("div",{className:"mt-4 md:mt-0 space-x-2 flex flex-wrap gap-2",children:[e.jsx(N,{asChild:!0,variant:"outline",children:e.jsxs(v,{to:"/projects/new",children:[e.jsx(k,{className:"h-4 w-4 mr-2"}),e.jsx("span",{className:"whitespace-nowrap",children:"New Project"})]})}),e.jsx(N,{asChild:!0,className:"bg-carbon-600 hover:bg-carbon-700 text-white",children:e.jsxs(v,{to:"/calculator",children:[e.jsx(X,{className:"h-4 w-4 mr-2"}),e.jsx("span",{className:"whitespace-nowrap",children:"New Calculation"})]})})]})]}),e.jsx(ne,{isOffline:o,hasError:!!l&&x>1&&!o,onRetry:P,isRetrying:!!h.current||i}),n&&(!t||t.length===0)?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[...Array(3)].map((w,R)=>e.jsx(re,{},R))}):t.length===0&&!o?e.jsxs("div",{className:"text-center py-12 border rounded-lg bg-white dark:bg-carbon-800 shadow-sm p-8",children:[e.jsx("h2",{className:"text-xl font-semibold mb-2",children:"No Projects Found"}),e.jsx("p",{className:"text-muted-foreground mb-6",children:f?"You haven't created any projects yet.":"Please sign in to view your projects."}),e.jsx("div",{className:"flex justify-center gap-2",children:e.jsx(N,{asChild:!0,variant:"outline",children:e.jsxs(v,{to:"/projects/new",children:[e.jsx(k,{className:"h-4 w-4 mr-2"}),"Create Your First Project"]})})})]}):e.jsx(te,{projects:t||[],title:"All Projects",showSearch:!0}),n&&t&&t.length>0&&e.jsx("div",{className:"flex justify-center mt-8",children:e.jsxs(N,{variant:"outline",onClick:P,className:"flex items-center gap-2",children:[e.jsx(A,{className:"h-4 w-4"}),"Refresh Projects"]})})]})})}):e.jsx(G,{isLoading:!0,text:"Loading projects..."})}),e.jsx(Z,{})]})};export{de as default};
//# sourceMappingURL=ProjectsBrowser-ddSI2-rH.js.map
