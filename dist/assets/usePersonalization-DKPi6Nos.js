import{r as _,s,i as d}from"./index-CHtXOOwB.js";const E=t=>{const[u,l]=_.useState({calculationHistory:[],complianceAlerts:[],favoriteMaterials:[],isLoading:!0,error:null});_.useEffect(()=>{if(!t){l(a=>({...a,isLoading:!1}));return}c()},[t]);const c=async()=>{if(t)try{l(i=>({...i,isLoading:!0,error:null}));const{data:a,error:r}=await s.from("user_calculation_history").select("*").eq("user_id",t).order("created_at",{ascending:!1}).limit(20);if(r)throw r;const{data:o,error:e}=await s.from("user_compliance_alerts").select("*").eq("user_id",t).order("created_at",{ascending:!1});if(e)throw e;const{data:f,error:n}=await s.from("user_material_favorites").select(`
          *,
          material:unified_materials(
            id,
            name,
            carbon_footprint_kgco2e_kg,
            category,
            description
          )
        `).eq("user_id",t).order("created_at",{ascending:!1});if(n)throw n;l({calculationHistory:a||[],complianceAlerts:o||[],favoriteMaterials:f||[],isLoading:!1,error:null})}catch(a){console.error("Error fetching personalization data:",a),l(r=>({...r,isLoading:!1,error:"Failed to load personalization data"}))}};return{...u,addToFavorites:async(a,r,o)=>{if(t)try{const{error:e}=await s.from("user_material_favorites").insert([{user_id:t,material_id:a,category:r,notes:o}]);if(e)throw e;d.success("Material added to favorites"),c()}catch(e){console.error("Error adding to favorites:",e),d.error("Failed to add material to favorites")}},removeFromFavorites:async a=>{if(t)try{const{error:r}=await s.from("user_material_favorites").delete().eq("user_id",t).eq("material_id",a);if(r)throw r;d.success("Material removed from favorites"),c()}catch(r){console.error("Error removing from favorites:",r),d.error("Failed to remove material from favorites")}},markAlertAsRead:async a=>{try{const{error:r}=await s.from("user_compliance_alerts").update({is_read:!0}).eq("id",a);if(r)throw r;l(o=>({...o,complianceAlerts:o.complianceAlerts.map(e=>e.id===a?{...e,is_read:!0}:e)}))}catch(r){console.error("Error marking alert as read:",r),d.error("Failed to update alert")}},saveCalculationHistory:async(a,r,o,e,f,n)=>{if(t)try{const{error:i}=await s.from("user_calculation_history").insert([{user_id:t,calculator_type:a,calculation_data:r,results:o,carbon_footprint:e,compliance_status:f,improvement_suggestions:n}]);if(i)throw i;c()}catch(i){console.error("Error saving calculation history:",i)}},createComplianceAlert:async(a,r,o,e="info",f,n=!1,i)=>{if(t)try{const{error:m}=await s.from("user_compliance_alerts").insert([{user_id:t,alert_type:a,title:r,message:o,severity:e,related_standard:f,action_required:n,expires_at:i==null?void 0:i.toISOString()}]);if(m)throw m;c()}catch(m){console.error("Error creating compliance alert:",m)}},refreshData:c}};export{E as u};
//# sourceMappingURL=usePersonalization-DKPi6Nos.js.map
