import{w as ns,aI as St,r as g,aJ as De,aK as Nt,aL as st,j as i,$ as Tt,U as os,I as At,B as he,aM as rt,aF as is,aN as cs,ab as ls,ac as Rt,ad as us,a1 as ds,b as kt,e as vt,f as jt,aO as Dt,c as fs,d as ps,a4 as ft,C as ms,X as hs,D as gs,aG as ys,aP as bs,N as xs,V as Es,W as ws,Y as Pe,R as Is,Z as Le,F as _s}from"./index-CHtXOOwB.js";import{s as Cs}from"./index-2Z0Ev104.js";import{G as Ss,K as Ns}from"./GrokUsageDisplay-DqN_3_1n.js";import{S as Ts}from"./settings-JWSwRKg3.js";import"./chart-no-axes-column-increasing-xe5XYUDs.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const As=ns("MessageSquare",[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}]]);var Ot="vercel.ai.error",Rs=Symbol.for(Ot),Pt,ks=class Lt extends Error{constructor({name:t,message:s,cause:r}){super(s),this[Pt]=!0,this.name=t,this.cause=r}static isInstance(t){return Lt.hasMarker(t,Ot)}static hasMarker(t,s){const r=Symbol.for(s);return t!=null&&typeof t=="object"&&r in t&&typeof t[r]=="boolean"&&t[r]===!0}};Pt=Rs;var de=ks;function Mt(e){return e==null?"unknown error":typeof e=="string"?e:e instanceof Error?e.message:JSON.stringify(e)}var Ft="AI_InvalidArgumentError",Vt=`vercel.ai.error.${Ft}`,vs=Symbol.for(Vt),Ut,js=class extends de{constructor({message:e,cause:t,argument:s}){super({name:Ft,message:e,cause:t}),this[Ut]=!0,this.argument=s}static isInstance(e){return de.hasMarker(e,Vt)}};Ut=vs;var Bt="AI_JSONParseError",Jt=`vercel.ai.error.${Bt}`,Ds=Symbol.for(Jt),$t,pt=class extends de{constructor({text:e,cause:t}){super({name:Bt,message:`JSON parsing failed: Text: ${e}.
Error message: ${Mt(t)}`,cause:t}),this[$t]=!0,this.text=e}static isInstance(e){return de.hasMarker(e,Jt)}};$t=Ds;var Wt="AI_TypeValidationError",Yt=`vercel.ai.error.${Wt}`,Os=Symbol.for(Yt),Gt,Ps=class We extends de{constructor({value:t,cause:s}){super({name:Wt,message:`Type validation failed: Value: ${JSON.stringify(t)}.
Error message: ${Mt(s)}`,cause:s}),this[Gt]=!0,this.value=t}static isInstance(t){return de.hasMarker(t,Yt)}static wrap({value:t,cause:s}){return We.isInstance(s)&&s.value===t?s:new We({value:t,cause:s})}};Gt=Os;var mt=Ps;let Ls=(e,t=21)=>(s=t)=>{let r="",a=s|0;for(;a--;)r+=e[Math.random()*e.length|0];return r};var fe={exports:{}};const Ms=typeof Buffer<"u",ht=/"(?:_|\\u005[Ff])(?:_|\\u005[Ff])(?:p|\\u0070)(?:r|\\u0072)(?:o|\\u006[Ff])(?:t|\\u0074)(?:o|\\u006[Ff])(?:_|\\u005[Ff])(?:_|\\u005[Ff])"\s*:/,gt=/"(?:c|\\u0063)(?:o|\\u006[Ff])(?:n|\\u006[Ee])(?:s|\\u0073)(?:t|\\u0074)(?:r|\\u0072)(?:u|\\u0075)(?:c|\\u0063)(?:t|\\u0074)(?:o|\\u006[Ff])(?:r|\\u0072)"\s*:/;function Kt(e,t,s){s==null&&t!==null&&typeof t=="object"&&(s=t,t=void 0),Ms&&Buffer.isBuffer(e)&&(e=e.toString()),e&&e.charCodeAt(0)===65279&&(e=e.slice(1));const r=JSON.parse(e,t);if(r===null||typeof r!="object")return r;const a=s&&s.protoAction||"error",c=s&&s.constructorAction||"error";if(a==="ignore"&&c==="ignore")return r;if(a!=="ignore"&&c!=="ignore"){if(ht.test(e)===!1&&gt.test(e)===!1)return r}else if(a!=="ignore"&&c==="ignore"){if(ht.test(e)===!1)return r}else if(gt.test(e)===!1)return r;return qt(r,{protoAction:a,constructorAction:c,safe:s&&s.safe})}function qt(e,{protoAction:t="error",constructorAction:s="error",safe:r}={}){let a=[e];for(;a.length;){const c=a;a=[];for(const n of c){if(t!=="ignore"&&Object.prototype.hasOwnProperty.call(n,"__proto__")){if(r===!0)return null;if(t==="error")throw new SyntaxError("Object contains forbidden prototype property");delete n.__proto__}if(s!=="ignore"&&Object.prototype.hasOwnProperty.call(n,"constructor")&&Object.prototype.hasOwnProperty.call(n.constructor,"prototype")){if(r===!0)return null;if(s==="error")throw new SyntaxError("Object contains forbidden prototype property");delete n.constructor}for(const l in n){const o=n[l];o&&typeof o=="object"&&a.push(o)}}}return e}function at(e,t,s){const r=Error.stackTraceLimit;Error.stackTraceLimit=0;try{return Kt(e,t,s)}finally{Error.stackTraceLimit=r}}function Fs(e,t){const s=Error.stackTraceLimit;Error.stackTraceLimit=0;try{return Kt(e,t,{safe:!0})}catch{return null}finally{Error.stackTraceLimit=s}}fe.exports=at;fe.exports.default=at;fe.exports.parse=at;fe.exports.safeParse=Fs;fe.exports.scan=qt;var Vs=fe.exports;const Us=St(Vs);var Bs=({prefix:e,size:t=16,alphabet:s="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",separator:r="-"}={})=>{const a=Ls(s,t);if(e==null)return a;if(s.includes(r))throw new js({argument:"separator",message:`The separator "${r}" must not be part of the alphabet "${s}".`});return c=>`${e}${r}${a(c)}`},nt=Bs(),Ye=Symbol.for("vercel.ai.validator");function Js(e){return{[Ye]:!0,validate:e}}function $s(e){return typeof e=="object"&&e!==null&&Ye in e&&e[Ye]===!0&&"validate"in e}function Ws(e){return $s(e)?e:Ys(e)}function Ys(e){return Js(t=>{const s=e.safeParse(t);return s.success?{success:!0,value:s.data}:{success:!1,error:s.error}})}function Gs({value:e,schema:t}){const s=Ws(t);try{if(s.validate==null)return{success:!0,value:e};const r=s.validate(e);return r.success?r:{success:!1,error:mt.wrap({value:e,cause:r.error})}}catch(r){return{success:!1,error:mt.wrap({value:e,cause:r})}}}function yt({text:e,schema:t}){try{const s=Us.parse(e);if(t==null)return{success:!0,value:s,rawValue:s};const r=Gs({value:s,schema:t});return r.success?{...r,rawValue:s}:r}catch(s){return{success:!1,error:pt.isInstance(s)?s:new pt({text:e,cause:s})}}}new Set("ABCDEFGHIJKLMNOPQRSTUVXYZabcdefghijklmnopqrstuvxyz0123456789");var ge={code:"0",name:"text",parse:e=>{if(typeof e!="string")throw new Error('"text" parts expect a string value.');return{type:"text",value:e}}},ye={code:"3",name:"error",parse:e=>{if(typeof e!="string")throw new Error('"error" parts expect a string value.');return{type:"error",value:e}}},be={code:"4",name:"assistant_message",parse:e=>{if(e==null||typeof e!="object"||!("id"in e)||!("role"in e)||!("content"in e)||typeof e.id!="string"||typeof e.role!="string"||e.role!=="assistant"||!Array.isArray(e.content)||!e.content.every(t=>t!=null&&typeof t=="object"&&"type"in t&&t.type==="text"&&"text"in t&&t.text!=null&&typeof t.text=="object"&&"value"in t.text&&typeof t.text.value=="string"))throw new Error('"assistant_message" parts expect an object with an "id", "role", and "content" property.');return{type:"assistant_message",value:e}}},xe={code:"5",name:"assistant_control_data",parse:e=>{if(e==null||typeof e!="object"||!("threadId"in e)||!("messageId"in e)||typeof e.threadId!="string"||typeof e.messageId!="string")throw new Error('"assistant_control_data" parts expect an object with a "threadId" and "messageId" property.');return{type:"assistant_control_data",value:{threadId:e.threadId,messageId:e.messageId}}}},Ee={code:"6",name:"data_message",parse:e=>{if(e==null||typeof e!="object"||!("role"in e)||!("data"in e)||typeof e.role!="string"||e.role!=="data")throw new Error('"data_message" parts expect an object with a "role" and "data" property.');return{type:"data_message",value:e}}},Ks=[ge,ye,be,xe,Ee];ge.code+"",ye.code+"",be.code+"",xe.code+"",Ee.code+"";ge.name+"",ge.code,ye.name+"",ye.code,be.name+"",be.code,xe.name+"",xe.code,Ee.name+"",Ee.code;Ks.map(e=>e.code);function qs({promptTokens:e,completionTokens:t}){return{promptTokens:e,completionTokens:t,totalTokens:e+t}}function Hs(e){const t=["ROOT"];let s=-1,r=null;function a(o,d,m){switch(o){case'"':{s=d,t.pop(),t.push(m),t.push("INSIDE_STRING");break}case"f":case"t":case"n":{s=d,r=d,t.pop(),t.push(m),t.push("INSIDE_LITERAL");break}case"-":{t.pop(),t.push(m),t.push("INSIDE_NUMBER");break}case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":{s=d,t.pop(),t.push(m),t.push("INSIDE_NUMBER");break}case"{":{s=d,t.pop(),t.push(m),t.push("INSIDE_OBJECT_START");break}case"[":{s=d,t.pop(),t.push(m),t.push("INSIDE_ARRAY_START");break}}}function c(o,d){switch(o){case",":{t.pop(),t.push("INSIDE_OBJECT_AFTER_COMMA");break}case"}":{s=d,t.pop();break}}}function n(o,d){switch(o){case",":{t.pop(),t.push("INSIDE_ARRAY_AFTER_COMMA");break}case"]":{s=d,t.pop();break}}}for(let o=0;o<e.length;o++){const d=e[o];switch(t[t.length-1]){case"ROOT":a(d,o,"FINISH");break;case"INSIDE_OBJECT_START":{switch(d){case'"':{t.pop(),t.push("INSIDE_OBJECT_KEY");break}case"}":{s=o,t.pop();break}}break}case"INSIDE_OBJECT_AFTER_COMMA":{switch(d){case'"':{t.pop(),t.push("INSIDE_OBJECT_KEY");break}}break}case"INSIDE_OBJECT_KEY":{switch(d){case'"':{t.pop(),t.push("INSIDE_OBJECT_AFTER_KEY");break}}break}case"INSIDE_OBJECT_AFTER_KEY":{switch(d){case":":{t.pop(),t.push("INSIDE_OBJECT_BEFORE_VALUE");break}}break}case"INSIDE_OBJECT_BEFORE_VALUE":{a(d,o,"INSIDE_OBJECT_AFTER_VALUE");break}case"INSIDE_OBJECT_AFTER_VALUE":{c(d,o);break}case"INSIDE_STRING":{switch(d){case'"':{t.pop(),s=o;break}case"\\":{t.push("INSIDE_STRING_ESCAPE");break}default:s=o}break}case"INSIDE_ARRAY_START":{switch(d){case"]":{s=o,t.pop();break}default:{s=o,a(d,o,"INSIDE_ARRAY_AFTER_VALUE");break}}break}case"INSIDE_ARRAY_AFTER_VALUE":{switch(d){case",":{t.pop(),t.push("INSIDE_ARRAY_AFTER_COMMA");break}case"]":{s=o,t.pop();break}default:{s=o;break}}break}case"INSIDE_ARRAY_AFTER_COMMA":{a(d,o,"INSIDE_ARRAY_AFTER_VALUE");break}case"INSIDE_STRING_ESCAPE":{t.pop(),s=o;break}case"INSIDE_NUMBER":{switch(d){case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":{s=o;break}case"e":case"E":case"-":case".":break;case",":{t.pop(),t[t.length-1]==="INSIDE_ARRAY_AFTER_VALUE"&&n(d,o),t[t.length-1]==="INSIDE_OBJECT_AFTER_VALUE"&&c(d,o);break}case"}":{t.pop(),t[t.length-1]==="INSIDE_OBJECT_AFTER_VALUE"&&c(d,o);break}case"]":{t.pop(),t[t.length-1]==="INSIDE_ARRAY_AFTER_VALUE"&&n(d,o);break}default:{t.pop();break}}break}case"INSIDE_LITERAL":{const f=e.substring(r,o+1);!"false".startsWith(f)&&!"true".startsWith(f)&&!"null".startsWith(f)?(t.pop(),t[t.length-1]==="INSIDE_OBJECT_AFTER_VALUE"?c(d,o):t[t.length-1]==="INSIDE_ARRAY_AFTER_VALUE"&&n(d,o)):s=o;break}}}let l=e.slice(0,s+1);for(let o=t.length-1;o>=0;o--)switch(t[o]){case"INSIDE_STRING":{l+='"';break}case"INSIDE_OBJECT_KEY":case"INSIDE_OBJECT_AFTER_KEY":case"INSIDE_OBJECT_AFTER_COMMA":case"INSIDE_OBJECT_START":case"INSIDE_OBJECT_BEFORE_VALUE":case"INSIDE_OBJECT_AFTER_VALUE":{l+="}";break}case"INSIDE_ARRAY_START":case"INSIDE_ARRAY_AFTER_COMMA":case"INSIDE_ARRAY_AFTER_VALUE":{l+="]";break}case"INSIDE_LITERAL":{const m=e.substring(r,e.length);"true".startsWith(m)?l+="true".slice(m.length):"false".startsWith(m)?l+="false".slice(m.length):"null".startsWith(m)&&(l+="null".slice(m.length))}}return l}function zs(e){if(e===void 0)return{value:void 0,state:"undefined-input"};let t=yt({text:e});return t.success?{value:t.value,state:"successful-parse"}:(t=yt({text:Hs(e)}),t.success?{value:t.value,state:"repaired-parse"}:{value:void 0,state:"failed-parse"})}var Xs={code:"0",name:"text",parse:e=>{if(typeof e!="string")throw new Error('"text" parts expect a string value.');return{type:"text",value:e}}},Zs={code:"2",name:"data",parse:e=>{if(!Array.isArray(e))throw new Error('"data" parts expect an array value.');return{type:"data",value:e}}},Qs={code:"3",name:"error",parse:e=>{if(typeof e!="string")throw new Error('"error" parts expect a string value.');return{type:"error",value:e}}},er={code:"8",name:"message_annotations",parse:e=>{if(!Array.isArray(e))throw new Error('"message_annotations" parts expect an array value.');return{type:"message_annotations",value:e}}},tr={code:"9",name:"tool_call",parse:e=>{if(e==null||typeof e!="object"||!("toolCallId"in e)||typeof e.toolCallId!="string"||!("toolName"in e)||typeof e.toolName!="string"||!("args"in e)||typeof e.args!="object")throw new Error('"tool_call" parts expect an object with a "toolCallId", "toolName", and "args" property.');return{type:"tool_call",value:e}}},sr={code:"a",name:"tool_result",parse:e=>{if(e==null||typeof e!="object"||!("toolCallId"in e)||typeof e.toolCallId!="string"||!("result"in e))throw new Error('"tool_result" parts expect an object with a "toolCallId" and a "result" property.');return{type:"tool_result",value:e}}},rr={code:"b",name:"tool_call_streaming_start",parse:e=>{if(e==null||typeof e!="object"||!("toolCallId"in e)||typeof e.toolCallId!="string"||!("toolName"in e)||typeof e.toolName!="string")throw new Error('"tool_call_streaming_start" parts expect an object with a "toolCallId" and "toolName" property.');return{type:"tool_call_streaming_start",value:e}}},ar={code:"c",name:"tool_call_delta",parse:e=>{if(e==null||typeof e!="object"||!("toolCallId"in e)||typeof e.toolCallId!="string"||!("argsTextDelta"in e)||typeof e.argsTextDelta!="string")throw new Error('"tool_call_delta" parts expect an object with a "toolCallId" and "argsTextDelta" property.');return{type:"tool_call_delta",value:e}}},nr={code:"d",name:"finish_message",parse:e=>{if(e==null||typeof e!="object"||!("finishReason"in e)||typeof e.finishReason!="string")throw new Error('"finish_message" parts expect an object with a "finishReason" property.');const t={finishReason:e.finishReason};return"usage"in e&&e.usage!=null&&typeof e.usage=="object"&&"promptTokens"in e.usage&&"completionTokens"in e.usage&&(t.usage={promptTokens:typeof e.usage.promptTokens=="number"?e.usage.promptTokens:Number.NaN,completionTokens:typeof e.usage.completionTokens=="number"?e.usage.completionTokens:Number.NaN}),{type:"finish_message",value:t}}},or={code:"e",name:"finish_step",parse:e=>{if(e==null||typeof e!="object"||!("finishReason"in e)||typeof e.finishReason!="string")throw new Error('"finish_step" parts expect an object with a "finishReason" property.');const t={finishReason:e.finishReason,isContinued:!1};return"usage"in e&&e.usage!=null&&typeof e.usage=="object"&&"promptTokens"in e.usage&&"completionTokens"in e.usage&&(t.usage={promptTokens:typeof e.usage.promptTokens=="number"?e.usage.promptTokens:Number.NaN,completionTokens:typeof e.usage.completionTokens=="number"?e.usage.completionTokens:Number.NaN}),"isContinued"in e&&typeof e.isContinued=="boolean"&&(t.isContinued=e.isContinued),{type:"finish_step",value:t}}},ir={code:"f",name:"start_step",parse:e=>{if(e==null||typeof e!="object"||!("messageId"in e)||typeof e.messageId!="string")throw new Error('"start_step" parts expect an object with an "id" property.');return{type:"start_step",value:{messageId:e.messageId}}}},cr={code:"g",name:"reasoning",parse:e=>{if(typeof e!="string")throw new Error('"reasoning" parts expect a string value.');return{type:"reasoning",value:e}}},lr={code:"h",name:"source",parse:e=>{if(e==null||typeof e!="object")throw new Error('"source" parts expect a Source object.');return{type:"source",value:e}}},ur={code:"i",name:"redacted_reasoning",parse:e=>{if(e==null||typeof e!="object"||!("data"in e)||typeof e.data!="string")throw new Error('"redacted_reasoning" parts expect an object with a "data" property.');return{type:"redacted_reasoning",value:{data:e.data}}}},dr={code:"j",name:"reasoning_signature",parse:e=>{if(e==null||typeof e!="object"||!("signature"in e)||typeof e.signature!="string")throw new Error('"reasoning_signature" parts expect an object with a "signature" property.');return{type:"reasoning_signature",value:{signature:e.signature}}}},fr={code:"k",name:"file",parse:e=>{if(e==null||typeof e!="object"||!("data"in e)||typeof e.data!="string"||!("mimeType"in e)||typeof e.mimeType!="string")throw new Error('"file" parts expect an object with a "data" and "mimeType" property.');return{type:"file",value:e}}},ot=[Xs,Zs,Qs,er,tr,sr,rr,ar,nr,or,ir,cr,lr,ur,dr,fr],pr=Object.fromEntries(ot.map(e=>[e.code,e]));Object.fromEntries(ot.map(e=>[e.name,e.code]));var mr=ot.map(e=>e.code),hr=e=>{const t=e.indexOf(":");if(t===-1)throw new Error("Failed to parse stream string. No separator found.");const s=e.slice(0,t);if(!mr.includes(s))throw new Error(`Failed to parse stream string. Invalid code ${s}.`);const r=s,a=e.slice(t+1),c=JSON.parse(a);return pr[r].parse(c)},gr=10;function yr(e,t){const s=new Uint8Array(t);let r=0;for(const a of e)s.set(a,r),r+=a.length;return e.length=0,s}async function br({stream:e,onTextPart:t,onReasoningPart:s,onReasoningSignaturePart:r,onRedactedReasoningPart:a,onSourcePart:c,onFilePart:n,onDataPart:l,onErrorPart:o,onToolCallStreamingStartPart:d,onToolCallDeltaPart:m,onToolCallPart:f,onToolResultPart:N,onMessageAnnotationsPart:y,onFinishMessagePart:A,onFinishStepPart:S,onStartStepPart:M}){const p=e.getReader(),v=new TextDecoder,D=[];let _=0;for(;;){const{value:b}=await p.read();if(b&&(D.push(b),_+=b.length,b[b.length-1]!==gr))continue;if(D.length===0)break;const u=yr(D,_);_=0;const E=v.decode(u,{stream:!0}).split(`
`).filter(h=>h!=="").map(hr);for(const{type:h,value:w}of E)switch(h){case"text":await(t==null?void 0:t(w));break;case"reasoning":await(s==null?void 0:s(w));break;case"reasoning_signature":await(r==null?void 0:r(w));break;case"redacted_reasoning":await(a==null?void 0:a(w));break;case"file":await(n==null?void 0:n(w));break;case"source":await(c==null?void 0:c(w));break;case"data":await(l==null?void 0:l(w));break;case"error":await(o==null?void 0:o(w));break;case"message_annotations":await(y==null?void 0:y(w));break;case"tool_call_streaming_start":await(d==null?void 0:d(w));break;case"tool_call_delta":await(m==null?void 0:m(w));break;case"tool_call":await(f==null?void 0:f(w));break;case"tool_result":await(N==null?void 0:N(w));break;case"finish_message":await(A==null?void 0:A(w));break;case"finish_step":await(S==null?void 0:S(w));break;case"start_step":await(M==null?void 0:M(w));break;default:{const j=h;throw new Error(`Unknown stream part type: ${j}`)}}}}async function xr({stream:e,update:t,onToolCall:s,onFinish:r,generateId:a=nt,getCurrentDate:c=()=>new Date,lastMessage:n}){var l,o;const d=(n==null?void 0:n.role)==="assistant";let m=d?1+((o=(l=n.toolInvocations)==null?void 0:l.reduce((u,E)=>{var h;return Math.max(u,(h=E.step)!=null?h:0)},0))!=null?o:0):0;const f=d?structuredClone(n):{id:a(),createdAt:c(),role:"assistant",content:"",parts:[]};let N,y,A;function S(u,E){const h=f.parts.find(w=>w.type==="tool-invocation"&&w.toolInvocation.toolCallId===u);h!=null?h.toolInvocation=E:f.parts.push({type:"tool-invocation",toolInvocation:E})}const M=[];let p=d?n==null?void 0:n.annotations:void 0;const v={};let D={completionTokens:NaN,promptTokens:NaN,totalTokens:NaN},_="unknown";function b(){const u=[...M];p!=null&&p.length&&(f.annotations=p);const E={...structuredClone(f),revisionId:a()};t({message:E,data:u,replaceLastMessage:d})}await br({stream:e,onTextPart(u){N==null?(N={type:"text",text:u},f.parts.push(N)):N.text+=u,f.content+=u,b()},onReasoningPart(u){var E;A==null?(A={type:"text",text:u},y!=null&&y.details.push(A)):A.text+=u,y==null?(y={type:"reasoning",reasoning:u,details:[A]},f.parts.push(y)):y.reasoning+=u,f.reasoning=((E=f.reasoning)!=null?E:"")+u,b()},onReasoningSignaturePart(u){A!=null&&(A.signature=u.signature)},onRedactedReasoningPart(u){y==null&&(y={type:"reasoning",reasoning:"",details:[]},f.parts.push(y)),y.details.push({type:"redacted",data:u.data}),A=void 0,b()},onFilePart(u){f.parts.push({type:"file",mimeType:u.mimeType,data:u.data}),b()},onSourcePart(u){f.parts.push({type:"source",source:u}),b()},onToolCallStreamingStartPart(u){f.toolInvocations==null&&(f.toolInvocations=[]),v[u.toolCallId]={text:"",step:m,toolName:u.toolName,index:f.toolInvocations.length};const E={state:"partial-call",step:m,toolCallId:u.toolCallId,toolName:u.toolName,args:void 0};f.toolInvocations.push(E),S(u.toolCallId,E),b()},onToolCallDeltaPart(u){const E=v[u.toolCallId];E.text+=u.argsTextDelta;const{value:h}=zs(E.text),w={state:"partial-call",step:E.step,toolCallId:u.toolCallId,toolName:E.toolName,args:h};f.toolInvocations[E.index]=w,S(u.toolCallId,w),b()},async onToolCallPart(u){const E={state:"call",step:m,...u};if(v[u.toolCallId]!=null?f.toolInvocations[v[u.toolCallId].index]=E:(f.toolInvocations==null&&(f.toolInvocations=[]),f.toolInvocations.push(E)),S(u.toolCallId,E),b(),s){const h=await s({toolCall:u});if(h!=null){const w={state:"result",step:m,...u,result:h};f.toolInvocations[f.toolInvocations.length-1]=w,S(u.toolCallId,w),b()}}},onToolResultPart(u){const E=f.toolInvocations;if(E==null)throw new Error("tool_result must be preceded by a tool_call");const h=E.findIndex(j=>j.toolCallId===u.toolCallId);if(h===-1)throw new Error("tool_result must be preceded by a tool_call with the same toolCallId");const w={...E[h],state:"result",...u};E[h]=w,S(u.toolCallId,w),b()},onDataPart(u){M.push(...u),b()},onMessageAnnotationsPart(u){p==null?p=[...u]:p.push(...u),b()},onFinishStepPart(u){m+=1,N=u.isContinued?N:void 0,y=void 0,A=void 0},onStartStepPart(u){d||(f.id=u.messageId),f.parts.push({type:"step-start"}),b()},onFinishMessagePart(u){_=u.finishReason,u.usage!=null&&(D=qs(u.usage))},onErrorPart(u){throw new Error(u)}}),r==null||r({message:f,finishReason:_,usage:D})}async function Er({stream:e,onTextPart:t}){const s=e.pipeThrough(new TextDecoderStream).getReader();for(;;){const{done:r,value:a}=await s.read();if(r)break;await t(a)}}async function wr({stream:e,update:t,onFinish:s,getCurrentDate:r=()=>new Date,generateId:a=nt}){const c={type:"text",text:""},n={id:a(),createdAt:r(),role:"assistant",content:"",parts:[c]};await Er({stream:e,onTextPart:l=>{n.content+=l,c.text+=l,t({message:{...n},data:[],replaceLastMessage:!1})}}),s==null||s(n,{usage:{completionTokens:NaN,promptTokens:NaN,totalTokens:NaN},finishReason:"unknown"})}var Ir=()=>fetch;async function _r({api:e,body:t,streamProtocol:s="data",credentials:r,headers:a,abortController:c,restoreMessagesOnFailure:n,onResponse:l,onUpdate:o,onFinish:d,onToolCall:m,generateId:f,fetch:N=Ir(),lastMessage:y,requestType:A="generate"}){var S,M,p;const D=await(A==="resume"?N(`${e}?chatId=${t.id}`,{method:"GET",headers:{"Content-Type":"application/json",...a},signal:(S=c==null?void 0:c())==null?void 0:S.signal,credentials:r}):N(e,{method:"POST",body:JSON.stringify(t),headers:{"Content-Type":"application/json",...a},signal:(M=c==null?void 0:c())==null?void 0:M.signal,credentials:r})).catch(_=>{throw n(),_});if(l)try{await l(D)}catch(_){throw _}if(!D.ok)throw n(),new Error((p=await D.text())!=null?p:"Failed to fetch the chat response.");if(!D.body)throw new Error("The response body is empty.");switch(s){case"text":{await wr({stream:D.body,update:o,onFinish:d,generateId:f});return}case"data":{await xr({stream:D.body,update:o,lastMessage:y,onToolCall:m,onFinish({message:_,finishReason:b,usage:u}){d&&_!=null&&d(_,{usage:u,finishReason:b})},generateId:f});return}default:{const _=s;throw new Error(`Unknown stream protocol: ${_}`)}}}function Ge(e){return e==null?void 0:e.reduce((t,s)=>{var r;return Math.max(t,(r=s.step)!=null?r:0)},0)}function Ht(e){var t;return(t=e.parts)!=null?t:[...e.toolInvocations?e.toolInvocations.map(s=>({type:"tool-invocation",toolInvocation:s})):[],...e.reasoning?[{type:"reasoning",reasoning:e.reasoning,details:[{type:"text",text:e.reasoning}]}]:[],...e.content?[{type:"text",text:e.content}]:[]]}function Me(e){return e.map(t=>({...t,parts:Ht(t)}))}function Ke(e,t){if(e===t)return!0;if(e==null||t==null)return!1;if(typeof e!="object"&&typeof t!="object")return e===t;if(e.constructor!==t.constructor)return!1;if(e instanceof Date&&t instanceof Date)return e.getTime()===t.getTime();if(Array.isArray(e)){if(e.length!==t.length)return!1;for(let a=0;a<e.length;a++)if(!Ke(e[a],t[a]))return!1;return!0}const s=Object.keys(e),r=Object.keys(t);if(s.length!==r.length)return!1;for(const a of s)if(!r.includes(a)||!Ke(e[a],t[a]))return!1;return!0}async function bt(e){if(!e)return[];if(globalThis.FileList&&e instanceof globalThis.FileList)return Promise.all(Array.from(e).map(async t=>{const{name:s,type:r}=t,a=await new Promise((c,n)=>{const l=new FileReader;l.onload=o=>{var d;c((d=o.target)==null?void 0:d.result)},l.onerror=o=>n(o),l.readAsDataURL(t)});return{name:s,contentType:r,url:a}}));if(Array.isArray(e))return e;throw new Error("Invalid attachments type")}function Cr({originalMaxToolInvocationStep:e,originalMessageCount:t,maxSteps:s,messages:r}){var a;const c=r[r.length-1];return s>1&&c!=null&&(r.length>t||Ge(c.toolInvocations)!==e)&&zt(c)&&((a=Ge(c.toolInvocations))!=null?a:0)<s}function zt(e){if(e.role!=="assistant")return!1;const t=e.parts.reduce((r,a,c)=>a.type==="step-start"?c:r,-1),s=e.parts.slice(t+1).filter(r=>r.type==="tool-invocation");return s.length>0&&s.every(r=>"result"in r.toolInvocation)}function Sr({messages:e,toolCallId:t,toolResult:s}){var r;const a=e[e.length-1],c=a.parts.find(l=>l.type==="tool-invocation"&&l.toolInvocation.toolCallId===t);if(c==null)return;const n={...c.toolInvocation,state:"result",result:s};c.toolInvocation=n,a.toolInvocations=(r=a.toolInvocations)==null?void 0:r.map(l=>l.toolCallId===t?n:l)}const Xt=0,Zt=1,Qt=2,xt=3;var Et=Object.prototype.hasOwnProperty;function qe(e,t){var s,r;if(e===t)return!0;if(e&&t&&(s=e.constructor)===t.constructor){if(s===Date)return e.getTime()===t.getTime();if(s===RegExp)return e.toString()===t.toString();if(s===Array){if((r=e.length)===t.length)for(;r--&&qe(e[r],t[r]););return r===-1}if(!s||typeof e=="object"){r=0;for(s in e)if(Et.call(e,s)&&++r&&!Et.call(t,s)||!(s in t)||!qe(e[s],t[s]))return!1;return Object.keys(t).length===r}}return e!==e&&t!==t}const ee=new WeakMap,re=()=>{},B=re(),He=Object,R=e=>e===B,z=e=>typeof e=="function",ae=(e,t)=>({...e,...t}),es=e=>z(e.then),Fe={},Re={},it="undefined",Ie=typeof window!=it,ze=typeof document!=it,Nr=Ie&&"Deno"in window,Tr=()=>Ie&&typeof window.requestAnimationFrame!=it,ts=(e,t)=>{const s=ee.get(e);return[()=>!R(t)&&e.get(t)||Fe,r=>{if(!R(t)){const a=e.get(t);t in Re||(Re[t]=a),s[5](t,ae(a,r),a||Fe)}},s[6],()=>!R(t)&&t in Re?Re[t]:!R(t)&&e.get(t)||Fe]};let Xe=!0;const Ar=()=>Xe,[Ze,Qe]=Ie&&window.addEventListener?[window.addEventListener.bind(window),window.removeEventListener.bind(window)]:[re,re],Rr=()=>{const e=ze&&document.visibilityState;return R(e)||e!=="hidden"},kr=e=>(ze&&document.addEventListener("visibilitychange",e),Ze("focus",e),()=>{ze&&document.removeEventListener("visibilitychange",e),Qe("focus",e)}),vr=e=>{const t=()=>{Xe=!0,e()},s=()=>{Xe=!1};return Ze("online",t),Ze("offline",s),()=>{Qe("online",t),Qe("offline",s)}},jr={isOnline:Ar,isVisible:Rr},Dr={initFocus:kr,initReconnect:vr},wt=!De.useId,we=!Ie||Nr,Or=e=>Tr()?window.requestAnimationFrame(e):setTimeout(e,1),Ve=we?g.useEffect:g.useLayoutEffect,Ue=typeof navigator<"u"&&navigator.connection,It=!we&&Ue&&(["slow-2g","2g"].includes(Ue.effectiveType)||Ue.saveData),ke=new WeakMap,Pr=e=>He.prototype.toString.call(e),Be=(e,t)=>e===`[object ${t}]`;let Lr=0;const et=e=>{const t=typeof e,s=Pr(e),r=Be(s,"Date"),a=Be(s,"RegExp"),c=Be(s,"Object");let n,l;if(He(e)===e&&!r&&!a){if(n=ke.get(e),n)return n;if(n=++Lr+"~",ke.set(e,n),Array.isArray(e)){for(n="@",l=0;l<e.length;l++)n+=et(e[l])+",";ke.set(e,n)}if(c){n="#";const o=He.keys(e).sort();for(;!R(l=o.pop());)R(e[l])||(n+=l+":"+et(e[l])+",");ke.set(e,n)}}else n=r?e.toJSON():t=="symbol"?e.toString():t=="string"?JSON.stringify(e):""+e;return n},ct=e=>{if(z(e))try{e=e()}catch{e=""}const t=e;return e=typeof e=="string"?e:(Array.isArray(e)?e.length:e)?et(e):"",[e,t]};let Mr=0;const tt=()=>++Mr;async function ss(...e){const[t,s,r,a]=e,c=ae({populateCache:!0,throwOnError:!0},typeof a=="boolean"?{revalidate:a}:a||{});let n=c.populateCache;const l=c.rollbackOnError;let o=c.optimisticData;const d=N=>typeof l=="function"?l(N):l!==!1,m=c.throwOnError;if(z(s)){const N=s,y=[],A=t.keys();for(const S of A)!/^\$(inf|sub)\$/.test(S)&&N(t.get(S)._k)&&y.push(S);return Promise.all(y.map(f))}return f(s);async function f(N){const[y]=ct(N);if(!y)return;const[A,S]=ts(t,y),[M,p,v,D]=ee.get(t),_=()=>{const L=M[y];return(z(c.revalidate)?c.revalidate(A().data,N):c.revalidate!==!1)&&(delete v[y],delete D[y],L&&L[0])?L[0](Qt).then(()=>A().data):A().data};if(e.length<3)return _();let b=r,u,E=!1;const h=tt();p[y]=[h,0];const w=!R(o),j=A(),q=j.data,X=j._c,J=R(X)?q:X;if(w&&(o=z(o)?o(J,q):o,S({data:o,_c:J})),z(b))try{b=b(J)}catch(L){u=L,E=!0}if(b&&es(b))if(b=await b.catch(L=>{u=L,E=!0}),h!==p[y][0]){if(E)throw u;return b}else E&&w&&d(u)&&(n=!0,S({data:J,_c:B}));if(n&&!E)if(z(n)){const L=n(b,J);S({data:L,error:B,_c:B})}else S({data:b,error:B,_c:B});if(p[y][1]=tt(),Promise.resolve(_()).then(()=>{S({_c:B})}),E){if(m)throw u;return}return b}}const _t=(e,t)=>{for(const s in e)e[s][0]&&e[s][0](t)},Fr=(e,t)=>{if(!ee.has(e)){const s=ae(Dr,t),r=Object.create(null),a=ss.bind(B,e);let c=re;const n=Object.create(null),l=(m,f)=>{const N=n[m]||[];return n[m]=N,N.push(f),()=>N.splice(N.indexOf(f),1)},o=(m,f,N)=>{e.set(m,f);const y=n[m];if(y)for(const A of y)A(f,N)},d=()=>{if(!ee.has(e)&&(ee.set(e,[r,Object.create(null),Object.create(null),Object.create(null),a,o,l]),!we)){const m=s.initFocus(setTimeout.bind(B,_t.bind(B,r,Xt))),f=s.initReconnect(setTimeout.bind(B,_t.bind(B,r,Zt)));c=()=>{m&&m(),f&&f(),ee.delete(e)}}};return d(),[e,a,d,c]}return[e,ee.get(e)[4]]},Vr=(e,t,s,r,a)=>{const c=s.errorRetryCount,n=a.retryCount,l=~~((Math.random()+.5)*(1<<(n<8?n:8)))*s.errorRetryInterval;!R(c)&&n>c||setTimeout(r,l,a)},Ur=qe,[rs,Br]=Fr(new Map),Jr=ae({onLoadingSlow:re,onSuccess:re,onError:re,onErrorRetry:Vr,onDiscarded:re,revalidateOnFocus:!0,revalidateOnReconnect:!0,revalidateIfStale:!0,shouldRetryOnError:!0,errorRetryInterval:It?1e4:5e3,focusThrottleInterval:5*1e3,dedupingInterval:2*1e3,loadingTimeout:It?5e3:3e3,compare:Ur,isPaused:()=>!1,cache:rs,mutate:Br,fallback:{}},jr),$r=(e,t)=>{const s=ae(e,t);if(t){const{use:r,fallback:a}=e,{use:c,fallback:n}=t;r&&c&&(s.use=r.concat(c)),a&&n&&(s.fallback=ae(a,n))}return s},Wr=g.createContext({}),Yr="$inf$",as=Ie&&window.__SWR_DEVTOOLS_USE__,Gr=as?window.__SWR_DEVTOOLS_USE__:[],Kr=()=>{as&&(window.__SWR_DEVTOOLS_REACT__=De)},qr=e=>z(e[1])?[e[0],e[1],e[2]||{}]:[e[0],null,(e[1]===null?e[2]:e[1])||{}],Hr=()=>ae(Jr,g.useContext(Wr)),zr=e=>(t,s,r)=>e(t,s&&((...c)=>{const[n]=ct(t),[,,,l]=ee.get(rs);if(n.startsWith(Yr))return s(...c);const o=l[n];return R(o)?s(...c):(delete l[n],o)}),r),Xr=Gr.concat(zr),Zr=e=>function(...s){const r=Hr(),[a,c,n]=qr(s),l=$r(r,n);let o=e;const{use:d}=l,m=(d||[]).concat(Xr);for(let f=m.length;f--;)o=m[f](o);return o(a,c||l.fetcher||null,l)},Qr=(e,t,s)=>{const r=t[e]||(t[e]=[]);return r.push(s),()=>{const a=r.indexOf(s);a>=0&&(r[a]=r[r.length-1],r.pop())}};Kr();const Je=De.use||(e=>{switch(e.status){case"pending":throw e;case"fulfilled":return e.value;case"rejected":throw e.reason;default:throw e.status="pending",e.then(t=>{e.status="fulfilled",e.value=t},t=>{e.status="rejected",e.reason=t}),e}}),$e={dedupe:!0},ea=(e,t,s)=>{const{cache:r,compare:a,suspense:c,fallbackData:n,revalidateOnMount:l,revalidateIfStale:o,refreshInterval:d,refreshWhenHidden:m,refreshWhenOffline:f,keepPreviousData:N}=s,[y,A,S,M]=ee.get(r),[p,v]=ct(e),D=g.useRef(!1),_=g.useRef(!1),b=g.useRef(p),u=g.useRef(t),E=g.useRef(s),h=()=>E.current,w=()=>h().isVisible()&&h().isOnline(),[j,q,X,J]=ts(r,p),L=g.useRef({}).current,K=R(n)?R(s.fallback)?B:s.fallback[p]:n,_e=(I,x)=>{for(const k in L){const C=k;if(C==="data"){if(!a(I[C],x[C])&&(!R(I[C])||!a(ce,x[C])))return!1}else if(x[C]!==I[C])return!1}return!0},oe=g.useMemo(()=>{const I=!p||!t?!1:R(l)?h().isPaused()||c?!1:o!==!1:l,x=O=>{const Y=ae(O);return delete Y._k,I?{isValidating:!0,isLoading:!0,...Y}:Y},k=j(),C=J(),F=x(k),W=k===C?F:x(C);let P=F;return[()=>{const O=x(j());return _e(O,P)?(P.data=O.data,P.isLoading=O.isLoading,P.isValidating=O.isValidating,P.error=O.error,P):(P=O,O)},()=>W]},[r,p]),V=Cs.useSyncExternalStore(g.useCallback(I=>X(p,(x,k)=>{_e(k,x)||I()}),[r,p]),oe[0],oe[1]),H=!D.current,$=y[p]&&y[p].length>0,te=V.data,Z=R(te)?K&&es(K)?Je(K):K:te,ie=V.error,pe=g.useRef(Z),ce=N?R(te)?R(pe.current)?Z:pe.current:te:Z,Ce=$&&!R(ie)?!1:H&&!R(l)?l:h().isPaused()?!1:c?R(Z)?!1:o:R(Z)||o,se=!!(p&&t&&H&&Ce),me=R(V.isValidating)?se:V.isValidating,Oe=R(V.isLoading)?se:V.isLoading,ne=g.useCallback(async I=>{const x=u.current;if(!p||!x||_.current||h().isPaused())return!1;let k,C,F=!0;const W=I||{},P=!S[p]||!W.dedupe,O=()=>wt?!_.current&&p===b.current&&D.current:p===b.current,Y={isValidating:!1,isLoading:!1},Ne=()=>{q(Y)},Te=()=>{const U=S[p];U&&U[1]===C&&delete S[p]},Ae={isValidating:!0};R(j().data)&&(Ae.isLoading=!0);try{if(P&&(q(Ae),s.loadingTimeout&&R(j().data)&&setTimeout(()=>{F&&O()&&h().onLoadingSlow(p,s)},s.loadingTimeout),S[p]=[x(v),tt()]),[k,C]=S[p],k=await k,P&&setTimeout(Te,s.dedupingInterval),!S[p]||S[p][1]!==C)return P&&O()&&h().onDiscarded(p),!1;Y.error=B;const U=A[p];if(!R(U)&&(C<=U[0]||C<=U[1]||U[1]===0))return Ne(),P&&O()&&h().onDiscarded(p),!1;const G=j().data;Y.data=a(G,k)?G:k,P&&O()&&h().onSuccess(k,p,s)}catch(U){Te();const G=h(),{shouldRetryOnError:Q}=G;G.isPaused()||(Y.error=U,P&&O()&&(G.onError(U,p,G),(Q===!0||z(Q)&&Q(U))&&(!h().revalidateOnFocus||!h().revalidateOnReconnect||w())&&G.onErrorRetry(U,p,G,le=>{const ue=y[p];ue&&ue[0]&&ue[0](xt,le)},{retryCount:(W.retryCount||0)+1,dedupe:!0})))}return F=!1,Ne(),!0},[p,r]),Se=g.useCallback((...I)=>ss(r,b.current,...I),[]);if(Ve(()=>{u.current=t,E.current=s,R(te)||(pe.current=te)}),Ve(()=>{if(!p)return;const I=ne.bind(B,$e);let x=0;h().revalidateOnFocus&&(x=Date.now()+h().focusThrottleInterval);const C=Qr(p,y,(F,W={})=>{if(F==Xt){const P=Date.now();h().revalidateOnFocus&&P>x&&w()&&(x=P+h().focusThrottleInterval,I())}else if(F==Zt)h().revalidateOnReconnect&&w()&&I();else{if(F==Qt)return ne();if(F==xt)return ne(W)}});return _.current=!1,b.current=p,D.current=!0,q({_k:v}),Ce&&(S[p]||(R(Z)||we?I():Or(I))),()=>{_.current=!0,C()}},[p]),Ve(()=>{let I;function x(){const C=z(d)?d(j().data):d;C&&I!==-1&&(I=setTimeout(k,C))}function k(){!j().error&&(m||h().isVisible())&&(f||h().isOnline())?ne($e).then(x):x()}return x(),()=>{I&&(clearTimeout(I),I=-1)}},[d,m,f,p]),g.useDebugValue(ce),c&&R(Z)&&p){if(!wt&&we)throw new Error("Fallback data is required when using Suspense in SSR.");u.current=t,E.current=s,_.current=!1;const I=M[p];if(!R(I)){const x=Se(I);Je(x)}if(R(ie)){const x=ne($e);R(ce)||(x.status="fulfilled",x.value=!0),Je(x)}else throw ie}return{mutate:Se,get data(){return L.data=!0,ce},get error(){return L.error=!0,ie},get isValidating(){return L.isValidating=!0,me},get isLoading(){return L.isLoading=!0,Oe}}},ve=Zr(ea);function ta(e,t){if(typeof e!="function")throw new TypeError(`Expected the first argument to be a \`function\`, got \`${typeof e}\`.`);let s,r=0;return function(...c){clearTimeout(s);const n=Date.now(),l=n-r,o=t-l;o<=0?(r=n,e.apply(this,c)):s=setTimeout(()=>{r=Date.now(),e.apply(this,c)},o)}}var sa=ta;const ra=St(sa);function Ct(e,t){return t!=null?ra(e,t):e}function aa(e){const[t,s]=g.useState(e);return g.useEffect(()=>{Ke(e,t)||s(e)},[e,t]),t}function na({api:e="/api/chat",id:t,initialMessages:s,initialInput:r="",sendExtraMessageFields:a,onToolCall:c,experimental_prepareRequestBody:n,maxSteps:l=1,streamProtocol:o="data",onResponse:d,onFinish:m,onError:f,credentials:N,headers:y,body:A,generateId:S=nt,fetch:M,keepLastMessageOnError:p=!0,experimental_throttle:v}={}){const[D]=g.useState(S),_=t??D,b=typeof e=="string"?[e,_]:_,u=aa(s??[]),E=g.useMemo(()=>Me(u),[u]),{data:h,mutate:w}=ve([b,"messages"],null,{fallbackData:E}),j=g.useRef(h||[]);g.useEffect(()=>{j.current=h||[]},[h]);const{data:q,mutate:X}=ve([b,"streamData"],null),J=g.useRef(q);g.useEffect(()=>{J.current=q},[q]);const{data:L="ready",mutate:K}=ve([b,"status"],null),{data:_e=void 0,mutate:oe}=ve([b,"error"],null),V=g.useRef(null),H=g.useRef({credentials:N,headers:y,body:A});g.useEffect(()=>{H.current={credentials:N,headers:y,body:A}},[N,y,A]);const $=g.useCallback(async(T,I="generate")=>{var x,k;K("submitted"),oe(void 0);const C=Me(T.messages),F=C.length,W=Ge((x=C[C.length-1])==null?void 0:x.toolInvocations);try{const O=new AbortController;V.current=O;const Y=Ct(w,v),Ne=Ct(X,v),Te=j.current;Y(C,!1);const Ae=a?C:C.map(({role:G,content:Q,experimental_attachments:le,data:ue,annotations:lt,toolInvocations:ut,parts:dt})=>({role:G,content:Q,...le!==void 0&&{experimental_attachments:le},...ue!==void 0&&{data:ue},...lt!==void 0&&{annotations:lt},...ut!==void 0&&{toolInvocations:ut},...dt!==void 0&&{parts:dt}})),U=J.current;await _r({api:e,body:(k=n==null?void 0:n({id:_,messages:C,requestData:T.data,requestBody:T.body}))!=null?k:{id:_,messages:Ae,data:T.data,...H.current.body,...T.body},streamProtocol:o,credentials:H.current.credentials,headers:{...H.current.headers,...T.headers},abortController:()=>V.current,restoreMessagesOnFailure(){p||Y(Te,!1)},onResponse:d,onUpdate({message:G,data:Q,replaceLastMessage:le}){K("streaming"),Y([...le?C.slice(0,C.length-1):C,G],!1),Q!=null&&Q.length&&Ne([...U??[],...Q],!1)},onToolCall:c,onFinish:m,generateId:S,fetch:M,lastMessage:C[C.length-1],requestType:I}),V.current=null,K("ready")}catch(O){if(O.name==="AbortError")return V.current=null,K("ready"),null;f&&O instanceof Error&&f(O),oe(O),K("error")}const P=j.current;Cr({originalMaxToolInvocationStep:W,originalMessageCount:F,maxSteps:l,messages:P})&&await $({messages:P})},[w,K,e,H,d,m,f,oe,X,J,o,a,n,c,l,j,V,S,M,p,v,_]),te=g.useCallback(async(T,{data:I,headers:x,body:k,experimental_attachments:C=T.experimental_attachments}={})=>{var F,W;const P=await bt(C),O=j.current.concat({...T,id:(F=T.id)!=null?F:S(),createdAt:(W=T.createdAt)!=null?W:new Date,experimental_attachments:P.length>0?P:void 0,parts:Ht(T)});return $({messages:O,headers:x,body:k,data:I})},[$,S]),Z=g.useCallback(async({data:T,headers:I,body:x}={})=>{const k=j.current;if(k.length===0)return null;const C=k[k.length-1];return $({messages:C.role==="assistant"?k.slice(0,-1):k,headers:I,body:x,data:T})},[$]),ie=g.useCallback(()=>{V.current&&(V.current.abort(),V.current=null)},[]),pe=g.useCallback(async()=>{const T=j.current;$({messages:T},"resume")},[$]),ce=g.useCallback(T=>{typeof T=="function"&&(T=T(j.current));const I=Me(T);w(I,!1),j.current=I},[w]),Ce=g.useCallback(T=>{typeof T=="function"&&(T=T(J.current)),X(T,!1),J.current=T},[X]),[se,me]=g.useState(r),Oe=g.useCallback(async(T,I={},x)=>{var k;if((k=T==null?void 0:T.preventDefault)==null||k.call(T),!se&&!I.allowEmptySubmit)return;x&&(H.current={...H.current,...x});const C=await bt(I.experimental_attachments),W={messages:j.current.concat({id:S(),createdAt:new Date,role:"user",content:se,experimental_attachments:C.length>0?C:void 0,parts:[{type:"text",text:se}]}),headers:I.headers,body:I.body,data:I.data};$(W),me("")},[se,S,$]),ne=T=>{me(T.target.value)},Se=g.useCallback(({toolCallId:T,result:I})=>{const x=j.current;if(Sr({messages:x,toolCallId:T,toolResult:I}),w([...x.slice(0,x.length-1),{...x[x.length-1]}],!1),L==="submitted"||L==="streaming")return;const k=x[x.length-1];zt(k)&&$({messages:x})},[w,L,$]);return{messages:h??[],id:_,setMessages:ce,data:q,setData:Ce,error:_e,append:te,reload:Z,stop:ie,experimental_resume:pe,input:se,setInput:me,handleInputChange:ne,handleSubmit:Oe,isLoading:L==="submitted"||L==="streaming",status:L,addToolResult:Se}}var oa=na;const je=()=>`msg_${Date.now()}_${Math.random().toString(36).substring(2,9)}`,ia=({initialContext:e,askAI:t,isConfigured:s,isProcessing:r}={})=>{const[a,c]=g.useState([]),[n,l]=g.useState(null),o=g.useRef(null),{isOffline:d}=Nt(),[m,f]=g.useState(!1),N=s!==void 0?s:m;g.useEffect(()=>{(!d&&(n!=null&&n.includes("network"))||n!=null&&n.includes("offline"))&&l(null)},[d,n]);const{input:y,handleInputChange:A,handleSubmit:S,isLoading:M}=oa({api:"/api/chat",onFinish:v=>{c(D=>[...D,{id:je(),role:"assistant",content:v.content,timestamp:new Date}])},onError:v=>{console.error("Error in chat:",v),d||v.message.includes("network")||v.message.includes("failed to fetch")?l("Network connection issue. Please check your internet and try again."):l(v.message||"An error occurred while processing your request.")}});return g.useEffect(()=>{e&&a.length===0&&c([{id:je(),role:"system",content:e,timestamp:new Date}])},[e,a.length]),{messages:a,error:n,isLoading:r||M,input:y,isConfigured:N,isOffline:d,handleInputChange:A,handleSubmit:async v=>{if(v.preventDefault(),!y.trim()||!N||r||M||d){d&&l("You're currently offline. Please reconnect to use AI services.");return}const D={id:je(),role:"user",content:y.trim(),timestamp:new Date};c(_=>[..._,D]),l(null);try{if(t){const _=await t(y.trim());c(b=>[...b,{id:je(),role:"assistant",content:_.response||_,timestamp:new Date}])}else S(v);o.current&&o.current.focus()}catch(_){console.error("Error in AI chat:",_),d||_ instanceof Error&&(_.message.includes("network")||_.message.includes("failed to fetch"))?l("Network connection issue. Please check your internet and try again."):l("Failed to get a response. Please try again.")}},inputRef:o}},ca=({messages:e,title:t,messagesEndRef:s})=>(st(),g.useEffect(()=>{s.current&&s.current.scrollIntoView({behavior:"smooth"})},[e]),i.jsx(i.Fragment,{children:e.length===0?i.jsxs("div",{className:"h-full flex flex-col items-center justify-center text-center p-4 text-muted-foreground",children:[i.jsx(Tt,{className:"h-10 w-10 sm:h-12 sm:w-12 mb-3 sm:mb-4 text-carbon-400"}),i.jsxs("h3",{className:"text-base sm:text-lg font-medium mb-1",children:["Welcome to ",t]}),i.jsx("p",{className:"max-w-md text-sm sm:text-base",children:"Ask questions about sustainable construction, materials, compliance, or best practices."})]}):i.jsxs("div",{className:"space-y-4 sm:space-y-6",children:[e.filter(r=>r.role!=="system").map(r=>i.jsx("div",{className:`flex ${r.role==="user"?"justify-end":"justify-start"}`,children:i.jsx("div",{className:`max-w-[90%] sm:max-w-[75%] rounded-lg px-3 py-2 sm:px-4 sm:py-2 text-sm sm:text-base ${r.role==="user"?"bg-carbon-600 text-white":"bg-carbon-100 dark:bg-carbon-800 text-carbon-800 dark:text-carbon-200"}`,children:i.jsx("div",{className:"whitespace-pre-line",children:r.content})})},r.id)),i.jsx("div",{ref:s})]})})),la=({input:e,handleInputChange:t,handleSubmit:s,placeholder:r,isLoading:a,isConfigured:c,isOffline:n=!1})=>{const l=g.useRef(null),{isMobile:o}=st();return c?i.jsxs("form",{onSubmit:s,className:"flex gap-2 w-full",children:[i.jsxs("div",{className:"relative flex-grow",children:[i.jsx(os,{className:"absolute left-3 top-2.5 h-4 w-4 text-muted-foreground"}),i.jsx(At,{ref:l,placeholder:n?"Offline mode - limited functionality":r,value:e,onChange:t,className:`pl-9 ${n?"bg-muted text-muted-foreground":""}`,disabled:a||n,autoComplete:"off",style:o?{fontSize:"16px",paddingTop:"10px",paddingBottom:"10px"}:{}})]}),i.jsxs(he,{type:"submit",size:o?"default":"icon",disabled:!e.trim()||a||n,className:o?"h-10 px-4":"",children:[n?i.jsx(rt,{className:"h-4 w-4"}):i.jsx(is,{className:"h-4 w-4"}),o&&i.jsx("span",{className:"ml-2",children:n?"Offline":"Send"})]})]}):null},ua=({error:e,isOffline:t=!1,onCheckConnection:s})=>{if(!e)return null;const r=t||cs(e),a=r?rt:Rt;return i.jsxs(ls,{variant:r?"warning":"destructive",className:"w-full mb-3 flex items-center",children:[De.createElement(a,{className:"h-4 w-4 mr-2"}),i.jsx("div",{className:"flex-grow mr-2",children:i.jsx(us,{className:"text-xs sm:text-sm",children:r?"Connection issue. Please check your internet and try again.":e})}),r&&s&&i.jsxs(he,{variant:"outline",size:"sm",className:"ml-auto flex items-center gap-1 h-7 text-xs",onClick:s,children:[i.jsx(ds,{className:"h-3 w-3"}),"Retry"]})]})},da=()=>i.jsx("div",{className:"w-full px-4 py-3 bg-amber-50 dark:bg-amber-900/20 border border-amber-200 dark:border-amber-800 rounded-md",children:i.jsxs("div",{className:"flex items-start",children:[i.jsx(Rt,{className:"h-5 w-5 text-amber-600 dark:text-amber-400 mr-2 mt-0.5"}),i.jsx("p",{className:"text-sm text-amber-700 dark:text-amber-300",children:"Grok AI is not configured. Please go to Settings to configure your API key."})]})}),fa=({messages:e,error:t,title:s,isLoading:r,isConfigured:a,input:c,handleInputChange:n,handleSubmit:l,placeholder:o,className:d})=>{const m=g.useRef(null),{isMobile:f}=st(),{isOffline:N,checkConnection:y}=Nt(),A=N&&a;return i.jsxs(kt,{className:`flex flex-col ${f?"h-[calc(100vh-240px)]":"h-[calc(100vh-320px)] md:h-[600px]"} ${d}`,children:[i.jsxs(vt,{className:"flex-1 overflow-y-auto py-4 px-3 sm:py-6 sm:px-6 relative",children:[A&&i.jsxs("div",{className:"absolute top-0 left-0 right-0 bg-amber-50 dark:bg-amber-950 border-b border-amber-200 dark:border-amber-800 p-2 sm:p-3 flex items-center justify-center",children:[i.jsx(rt,{className:"h-4 w-4 sm:h-5 sm:w-5 text-amber-600 dark:text-amber-400 mr-2"}),i.jsx("span",{className:"text-xs sm:text-sm text-amber-700 dark:text-amber-300",children:"You're offline. Grok services will be limited until connection is restored."})]}),i.jsx(ca,{messages:e,title:s,messagesEndRef:m})]}),i.jsxs(jt,{className:"p-3 sm:p-4 border-t",children:[i.jsx(ua,{error:t,isOffline:N,onCheckConnection:y}),a?i.jsxs("div",{className:"w-full flex flex-col sm:flex-row gap-2",children:[i.jsx("div",{className:"flex-grow relative",children:i.jsx(la,{input:c,handleInputChange:n,handleSubmit:l,placeholder:f?"Ask Grok...":o,isLoading:r,isConfigured:a,isOffline:N})}),i.jsx("div",{className:f?"mt-2 w-full":"hidden sm:block w-48",children:i.jsx(Ss,{compact:!f})})]}):i.jsx(da,{})]})]})},pa=({placeholder:e="Ask Claude about sustainable construction...",className:t})=>{const{askClaude:s,isConfigured:r,isProcessing:a}=Dt(),{messages:c,input:n,error:l,handleInputChange:o,handleSubmit:d}=ia({askAI:s,isConfigured:r,isProcessing:a});return i.jsx(fa,{messages:c,error:l,title:"Claude AI Assistant",isLoading:a,isConfigured:r,input:n,handleInputChange:o,handleSubmit:d,placeholder:e,className:t})},ma=({onComplete:e})=>{const{isConfigured:t,configureClaude:s,resetClaude:r}=Dt(),[a,c]=g.useState(""),n=()=>{s(a),c(""),e&&e()};return i.jsxs(kt,{className:"w-full max-w-md mx-auto",children:[i.jsxs(fs,{children:[i.jsxs(ps,{className:"flex items-center justify-between",children:["Claude AI Configuration",t?i.jsxs(ft,{variant:"outline",className:"bg-green-100 text-green-800 border-green-300",children:[i.jsx(ms,{className:"h-3 w-3 mr-1"})," Configured"]}):i.jsxs(ft,{variant:"outline",className:"bg-amber-100 text-amber-800 border-amber-300",children:[i.jsx(hs,{className:"h-3 w-3 mr-1"})," Not Configured"]})]}),i.jsx(gs,{children:"Connect CarbonConstruct to Claude AI for advanced sustainability analysis"})]}),i.jsx(vt,{children:i.jsx("div",{className:"space-y-4",children:i.jsxs("div",{className:"space-y-2",children:[i.jsx("label",{htmlFor:"api-key",className:"text-sm font-medium",children:"Anthropic API Key"}),i.jsx("div",{className:"flex",children:i.jsxs("div",{className:"relative flex-grow",children:[i.jsx(Ns,{className:"absolute left-3 top-2.5 h-4 w-4 text-muted-foreground"}),i.jsx(At,{id:"api-key",type:"password",placeholder:"Enter your Anthropic API key",value:a,onChange:l=>c(l.target.value),className:"pl-9"})]})}),i.jsx("p",{className:"text-xs text-muted-foreground",children:"Your API key is securely stored and used only for communication with Claude AI."})]})})}),i.jsxs(jt,{className:"flex justify-between",children:[t?i.jsx(he,{variant:"destructive",onClick:r,children:"Reset API Key"}):i.jsx(he,{variant:"ghost",children:"Cancel"}),i.jsxs(he,{onClick:n,disabled:!a.trim(),children:[t?"Update":"Configure"," Claude AI"]})]})]})};function Ea(){const[e,t]=g.useState("chat");return ys({title:"Claude AI - CarbonConstruct",announceRouteChanges:!0,focusMainContentOnRouteChange:!0}),i.jsx(bs,{children:i.jsxs("div",{className:"flex min-h-screen flex-col",children:[i.jsx(xs,{}),i.jsxs("main",{className:"flex-grow container mx-auto px-4 pt-24 pb-12",id:"main-content",tabIndex:-1,children:[i.jsxs("div",{className:"mb-8",children:[i.jsx("h1",{className:"text-3xl font-bold text-carbon-800 dark:text-carbon-100 mb-2",children:"Claude AI Assistant"}),i.jsx("p",{className:"text-carbon-600 dark:text-carbon-300",children:"Leverage Anthropic's Claude AI to optimize your sustainable construction projects"})]}),i.jsxs(Es,{defaultValue:e,onValueChange:t,className:"w-full",children:[i.jsxs(ws,{className:"grid grid-cols-3 mb-8",children:[i.jsxs(Pe,{value:"chat",className:"flex items-center gap-2",children:[i.jsx(As,{className:"h-4 w-4"}),i.jsx("span",{children:"Chat"})]}),i.jsxs(Pe,{value:"analysis",className:"flex items-center gap-2",children:[i.jsx(Is,{className:"h-4 w-4"}),i.jsx("span",{children:"Analysis"})]}),i.jsxs(Pe,{value:"settings",className:"flex items-center gap-2",children:[i.jsx(Ts,{className:"h-4 w-4"}),i.jsx("span",{children:"Settings"})]})]}),i.jsx(Le,{value:"chat",className:"w-full",children:i.jsx(pa,{placeholder:"Ask Claude about sustainable construction materials, compliance, or best practices..."})}),i.jsx(Le,{value:"analysis",children:i.jsxs("div",{className:"text-center py-12",children:[i.jsx(Tt,{className:"h-16 w-16 mx-auto mb-4 text-carbon-500"}),i.jsx("h3",{className:"text-xl font-medium mb-2",children:"Material Analysis Coming Soon"}),i.jsx("p",{className:"text-muted-foreground mb-4",children:"Advanced material sustainability analysis with Claude AI will be available soon."})]})}),i.jsx(Le,{value:"settings",children:i.jsx(ma,{})})]})]}),i.jsx(_s,{})]})})}export{Ea as default};
//# sourceMappingURL=ClaudeAI-BbuR7SQJ.js.map
